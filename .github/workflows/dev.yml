name: Standalone CLI

on: [push, pull_request]

jobs:
  machineStandalone:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@f095bcc56b7c2baf48f3ac70d6d6782f4f553222
      
      - name: Create results directory
        run: mkdir -p scan-results
      
      - uses: docker://docker.io/fluidattacks/cli:latest
        name: machineStandalone
        with:
          args: skims scan ./config.yml --output-file ./scan-results/scan-report.json
      
      - name: Generate summary report
        run: |
          echo "Scan completed at $(date)" > scan-results/summary.txt
          echo "Repository: ${{ github.repository }}" >> scan-results/summary.txt
          echo "Commit: ${{ github.sha }}" >> scan-results/summary.txt
          if [ -f scan-results/scan-report.json ]; then
            echo "Full results available in scan-report.json" >> scan-results/summary.txt
          fi
      
      - name: Upload scan results
        uses: actions/upload-artifact@v4
        if: always()  # Upload artifacts even if the scan fails
        with:
          name: security-scan-results
          path: scan-results/
          retention-days: 30